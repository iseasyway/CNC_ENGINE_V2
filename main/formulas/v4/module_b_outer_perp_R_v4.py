# -*- coding: utf-8 -*-
"""
module_b_outer_perp_R.py
============================================================
ğŸ­ B å·¥å» ï¼šå¤–å¾‘æ¥æ–œè§’.äº¤é»å€’rè§’(æ¨¡ç‰ˆ)(4)

============================================================
"""

import math


def solve_b(data):

    """
    B å·¥å» ä¸»é‹ç®—å‡½å¼

    è¼¸å…¥è³‡æ–™ dataï¼š
    {
       K1 = B2  # å°å¾‘X
       K2 = B3 # Zè»¸åŸé»è‡³æ–œåº¦è§’èµ·å§‹è·é›¢
       K3 = K3    # æ–œåº¦è§’
       K4 = B5    # Rè§’
       K5 = B6    # åˆ€é¼»åŠå¾‘
    }

    è¼¸å‡ºï¼š
    {
      ok: True,
      text_lines: [...],   # CLI / Debug é¡¯ç¤º
      values: {...}        # èˆªæ¯çµ±ä¸€è¼¸å‡º
    }
    """

    # ==================================================
    # 1ï¸âƒ£ è®€å–ä¸¦æ•´ç†è¼¸å…¥ï¼ˆå°é½Š Excel B ç³»åˆ—ï¼‰
    # --------------------------------------------------
    # èªªæ˜ï¼š
    # - æ‰€æœ‰è¼¸å…¥çš†è½‰ç‚º float
    # - å¤–å¾‘ä¸€å¾‹è½‰ç‚ºåŠå¾‘è¨ˆç®—
    # ==================================================
    B2 = float(data["å‰ç«¯xè»¸å¤–å¾‘"]) / 2          # å¤–åœ“åŠå¾‘
    B3 = -abs(float(data["zè»¸é•·åº¦"]) ) 
    B4 = float(data["æ–œåº¦è§’"])               
    B6 = float(data["Rè§’"])                      # ç«¯é¢ R
    B7 = float(data["åˆ€é¼»åŠå¾‘"])  *2           # åˆ€é¼»åŠå¾‘

       
     # ===== ä¸­é–“é‡ï¼ˆå®Œå…¨ç­‰åƒ¹ Excelï¼‰=====
    B10 = B7 / 2.0                            # =B7/2
    B11 = -1.0 / math.tan(math.radians(B4))   # =-1/TAN(RADIANS(B4))
    B12 = B3 - B11 * B2                        # =B3 - B11*B2
    B13 = math.sqrt(1.0 + B11**2)              # =SQRT(1+B11^2)
    B14 = B2 + B6                              # =B2 + B6
    B15 = B11*B14 + B12 + B6*B13               # =B11*B14 + B12 + B6*B13
    B16 = B6 - B10                             # =B6 - B10 (ä¹Ÿå°±æ˜¯ E9)
    B23 = B12 + B10*B13                        # =B12 + B10*B13
    B24 = 1.0 + B11**2                         # =1 + B11^2
    B25 = 2.0 * ( B11*(B23 - B15) - B14 )      # =2*( B11*(B23 - B15) - B14 )
    B26 = B14**2 + (B23 - B15)**2 - B16**2     # =B14^2 + (B23 - B15)^2 - B16^2

    # B27 = -B25/(2*B24)
    B27 = -B25 / (2.0 * B24)

    # B28 = B11*B27 + B23
    B28 = B11*B27 + B23

    # ===== è¼¸å‡ºï¼ˆå°æ‡‰ Excel æ¬„ä½ï¼‰=====
    E3 = B15        # =B19
    E4 = B2 + B10   # =B20 (= B2 + B10)
    E6 = B28        # =B28
    E7 = B27        # =B27
    E9 = B6 - B10   # =B6 - B10 (åŒ B16)

    B52=E3-B10
    B51=(E4-B10)*2
    B53=E6-B10
    B54=(E7-B10)*2
    B55=E9



    # ==================================================
    # 3ï¸âƒ£ æ•´ç†ç‚ºã€Œèˆªæ¯æ¨™æº–è¼¸å‡ºæ ¼å¼ã€
    # --------------------------------------------------
    # text_linesï¼š
    # - çµ¦ Terminal / Debug ä½¿ç”¨
    # - å¹«åŠ©äººå·¥é©—ç®—ã€å°ç…§ Excel
    # ==================================================
    text_lines = [
        "â¡ï¸ å¤–åœ“å‚ç›´ç«¯ Rè§’é‹ç®—çµæœï¼ˆB å·¥å» ï¼‰",
        f"B52ï¼ˆå‰ç«¯ Zï¼‰ = {B52:.6f}",
        f"B51ï¼ˆä¸­é–“å€¼ Xï¼‰ = {B51:.6f}",
        f"B53ï¼ˆå¾Œç«¯ Zï¼‰ = {B53:.6f}",
        f"B54ï¼ˆå¾Œç«¯ Xï¼‰ = {B54:.6f}",
        f"B55ï¼ˆåˆ€é¼»è£œæ­£ Rï¼‰ = {B55:.6f}",
    ]


    # ==================================================
    # 4ï¸âƒ£ çµ±ä¸€ values è¼¸å‡ºï¼ˆçµ¦èˆªæ¯ä¸»æ§ä½¿ç”¨ï¼‰
    # --------------------------------------------------
    # key å‘½åèªªæ˜ï¼š
    # - ä½¿ç”¨ OUT_ å‰ç¶´ï¼Œé¿å…èˆ‡å…¶ä»–å·¥å» è¡çª
    # - master / solver å¯ç›´æ¥å–ç”¨
    # ==================================================
    result_values = {
        "OUT_B52": B52,
        "OUT_B51": B51,   # ä¿ç•™æ¬„ä½ï¼ˆç›®å‰ master æœªä½¿ç”¨ï¼‰
        "OUT_B53": B53,
        "OUT_B54": B54,
        "OUT_B55": B55,
    }

    return {
        "ok": True,
        "text_lines": text_lines,
        "values": result_values
    }
def solve(data: dict):
    return solve_b(data)