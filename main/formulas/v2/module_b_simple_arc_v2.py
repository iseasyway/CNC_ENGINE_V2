# -*- coding: utf-8 -*-
"""
module_b_simple_arc_v2.py
============================================================
ğŸ­ V2 - B å·¥å» ï½œSimple Arcï¼ˆæ­£å¼ç‰ˆï¼‰

è§’è‰²å®šä½ï¼š
- æ ¹æ“šã€Œè§’åº¦ + åŠå¾‘ã€è¨ˆç®—åœ“å¼§èµ·å§‹ X ä½ç§»
- ç´”å¹¾ä½•å·¥å…·å‹æ¨¡çµ„
- ä¸ä¾è³´å…¶ä»–å·¥å» ï¼ˆA / C / Dï¼‰

è¼¸å…¥ï¼ˆç”± v2_router / v2_solver å‚³å…¥ï¼‰ï¼š
- K2ï¼šè§’åº¦ï¼ˆåº¦ï¼‰
- K5ï¼šåˆ€é¼»åŠå¾‘

è¼¸å‡ºï¼š
- B51ï¼šX ä½ç§»é‡
============================================================
"""

import math

DISPLAY_DECIMALS = 3


# ----------------------------------------------------------
# åŸå§‹å…¬å¼æ ¸å¿ƒï¼ˆä½ æä¾›çš„ç‰ˆæœ¬ï¼Œå®Œå…¨ä¿ç•™ï¼‰
# ----------------------------------------------------------
def solve_simple_arc(angle_deg, radius):
    t = math.tan(math.radians(angle_deg))      # B5
    s = math.sqrt(1.0 + t * t)                 # B6
    B9  = radius * (s - 1.0) / t               # B9
    B12 = B9 - radius                          # B12
    B14 = abs(B12)                             # B14
    return B14


# ----------------------------------------------------------
# ğŸ­ V2 æ¨™æº–å…¥å£
# ----------------------------------------------------------
def solve(data: dict):
    """
    V2 B å·¥å» æ¨™æº–å…¥å£ï¼ˆæ­£å¼ç‰ˆï¼‰

    data éœ€åŒ…å«ï¼š
      K2ï¼šè§’åº¦
      K5ï¼šåˆ€é¼»åŠå¾‘
    """

    # ========= è®€å–æ­£å¼åƒæ•¸ =========
    K2 = data.get("K2")   # è§’åº¦
    K5 = data.get("K5")   # åˆ€é¼»åŠå¾‘

    if K2 is None or K5 is None:
        raise ValueError("B å·¥å» éŒ¯èª¤ï¼šK2(è§’åº¦) èˆ‡ K5(åˆ€é¼»åŠå¾‘) å¿…é ˆè¼¸å…¥")

    angle = float(K2)
    radius = float(K5)

    if abs(angle) < 1e-12:
        raise ValueError("B å·¥å» éŒ¯èª¤ï¼šè§’åº¦ä¸å¯ç‚º 0")

    # ========= å‘¼å«å…¬å¼æ ¸å¿ƒ =========
    B51 = solve_simple_arc(angle, radius)

    # ========= å›å‚³æ­£å¼ç‰ˆæ ¼å¼ =========
    return {
        "ok": True,
        "values": {
            "B51": B51,
        },
        "text_lines": [
            "B å·¥å» ï¼ˆSimple Arc v2ï¼‰å®Œæˆ",
            f"B51 = {B51:.{DISPLAY_DECIMALS}f}",
        ]
    }
