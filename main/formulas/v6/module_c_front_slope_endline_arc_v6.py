# -*- coding: utf-8 -*-
"""

============================================================
ğŸ­ C å·¥å» ï¼šå‰ç«¯æ–œè§’çµ‚é»å¹³ç·šåœ“å­¤åœ¨çµ‚é»(æ¨¡ç‰ˆ)

============================================================
"""

import math

# -------------------------------------------------------
# ğŸ§  æ ¸å¿ƒè¨ˆç®—ï¼ˆC å·¥å» ï¼‰
# -------------------------------------------------------
def solve_c(data):

  
    # ===================================================
    # 1ï¸âƒ£ è®€å–ä¸¦æ•´ç†è¼¸å…¥ï¼ˆå°é½Š Excel B æ¬„ï¼‰
    # ===================================================
    B2  = float(data["å°å¾‘X"]) / 2.0    #èµ·å§‹é»Xç›´å¾‘
    B3  = float(data["è§’åº¦2"])    #å‰ç«¯è§’åº¦
    B4  = float(data["çµ‚ç«¯X"]) / 2.0    #çµ‚é»Xç›´å¾‘
    B5  = float(data["çµ‚ç«¯R2"])   #æœªç«¯Rè§’
    B6  = float(data["åˆ€é¼»åŠå¾‘"]) *2    #åˆ€é¼»ç›´å¾‘
    B8  = 0         
    B9  = float(data["åŸé»è‡³çµ‚é»é¢W"])
   # === åŸºæœ¬é‡ ===
    B10 = -math.tan(math.radians(B3))
    B11 = B2 - B10 * B8
    B12 = math.sqrt(1.0 + B10**2)

    B13 = B6 / 2.0
    B14 = B5 + B13
    B16 = B4 - B5

    # === ç¬¬ä¸€å€‹åœ“èˆ‡ç›´ç·šäº¤æœƒï¼ˆæ±ºå®š B28,B29ï¼‰===
    # ç›´ç·šï¼šX = B10*Z + B11
    # åœ“å¿ƒï¼š(B16, B17) åŠå¾‘ B5
    B17 = (B16 - B11 + B5*B12) / B10

    B20 = 1.0 + B10**2
    B21 = 2.0 * ( B10*(B11 - B16) - B17 )
    B22 = B17**2 + (B11 - B16)**2 - B5**2
    B23 = B21**2 - 4.0*B20*B22
    # å…©æ ¹
    sqrt_B23 = math.sqrt(max(0.0, B23))
    B24 = (-B21 - sqrt_B23) / (2.0*B20)
    B25 = (-B21 + sqrt_B23) / (2.0*B20)
    B26 = B10 * B24 + B11
    B27 = B10 * B25 + B11
    # ä¾ Excelï¼šB28,B29 ç”¨ IF é¸è¼ƒå°çš„ Z æ ¹åŠå°æ‡‰ X
    if B24 < B25:
        B28, B29 = B24, B26
    else:
        B28, B29 = B25, B27

    # === ç¬¬äºŒå€‹åœ“ï¼ˆåŠå¾‘æ›æˆ B14ï¼‰èˆ‡åŒä¸€ç›´ç·šäº¤æœƒï¼ˆB37..B40ï¼‰===
    B32 = B11 + B13 * B12        # å¹³ç§»å¾Œçš„æˆªè·
    B33 = 1.0 + B10**2
    B34 = 2.0 * ( B10*(B32 - B16) - B17 )
    B35 = B17**2 + (B32 - B16)**2 - B14**2
    B36 = B34**2 - 4.0*B33*B35
    sqrt_B36 = math.sqrt(max(0.0, B36))
    # å…©æ ¹
    B37 = (-B34 - sqrt_B36) / (2.0*B33)
    B38 = (-B34 + sqrt_B36) / (2.0*B33)
    B39 = B10 * B37 + B32
    B40 = B10 * B38 + B32

    # === E2, E3ï¼ˆç­‰åƒ¹ Excel çš„ B41, B42ï¼‰===
    # B41 = IF( (B37-B28)^2+(B39-B29)^2 <= (B38-B28)^2+(B40-B29)^2, B37, B38 )
    d1 = (B37 - B28)**2 + (B39 - B29)**2
    d2 = (B38 - B28)**2 + (B40 - B29)**2
    B41 = B37 if d1 <= d2 else B38
    # B42 = IF(B41=B37, B39, B40)
    B42 = B39 if (abs(B41 - B37) < 1e-12) else B40

    # === E5ï¼ˆ=B45ï¼‰ã€E4ï¼ˆ=B46ï¼‰===
    B45 = B4 + B13
    # B46 = B17 - sqrt( max(0, B14^2 - (B45 - B16)^2 ) )
    inside = max(0.0, B14**2 - (B45 - B16)**2)
    B46 = B17 - math.sqrt(inside)
    B51 = B41-B13-B9
    B52= (B42-B13)*2
    B53= (B45-B13)*2
    B54=  B46-B13-B9
    B55=  B5+B13
   

    def _fmt(x):
        # ä¾‹å¦‚å›ºå®šé¡¯ç¤ºåˆ°å°æ•¸é»å…©ä½
        return f"{x:.3f}"              
    
    result_values = {
         "B51": B51,
         "B52": B52,
         "B53": B53,
         "B54": B54,
         "B55": B55,
     }

    text_lines = [
        "â¡ï¸ å‰ç«¯æ–œè§’ â†’ å¹³ç·š â†’ çµ‚é»å¼§ï¼ˆC å·¥å» ï¼‰",
        f"B51 = {_fmt(B51)}",
        f"B52 = {_fmt(B52)}",
        f"B53 = {_fmt(B53)}",
        f"B54 = {_fmt(B54)}",
        f"B55 = {_fmt(B55)}",
    ]

    return {
        "ok": True,
        "text_lines": text_lines,
        "values": result_values,
    }


# -------------------------------------------------------
# ğŸ” å°å¤–çµ±ä¸€ä»‹é¢
# -------------------------------------------------------
def solve(data: dict):
    return solve_c(data)