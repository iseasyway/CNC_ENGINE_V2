# -*- coding: utf-8 -*-
"""
module_b_outer_perp_R.py
============================================================
ğŸ­ B å·¥å» ï¼šå¤–å¾‘æ¥æ–œè§’.äº¤é»å€’rè§’(æ¨¡ç‰ˆ)(4)

============================================================
"""

import math


def solve_b(data):


    # ==================================================
    # 1ï¸âƒ£ è®€å–ä¸¦æ•´ç†è¼¸å…¥ï¼ˆå°é½Š Excel B ç³»åˆ—ï¼‰
    # --------------------------------------------------
    # èªªæ˜ï¼š
    # - æ‰€æœ‰è¼¸å…¥çš†è½‰ç‚º float
    # - å¤–å¾‘ä¸€å¾‹è½‰ç‚ºåŠå¾‘è¨ˆç®—
    # ==================================================
    B4  = float(data["å¤§å¾‘X"]) / 2.0
    B5  = -abs(float(data["å·¥ä»¶åŸé»è‡³æ–œåº¦è§’W"]) )
    B6  = float(data["è§’åº¦"])
    B7  = float(data["å°å¾‘X"]) / 2.0
    B8  = 0.
    B9  = float(data["å‰ç«¯Rè§’"])
    B10 = float(data["åˆ€é¼»åŠå¾‘"]) *2
   
  
             
     # ======== åŸºç¤ä¸‰è§’é‹ç®—ï¼ˆEæ¬„å…¬å¼ï¼‰========
    E4 = B10 / 2.0                     # åˆ€é¼»åŠå¾‘
    E5 = math.sin(math.radians(B6))    # sin(è§’åº¦)
    E6 = math.cos(math.radians(B6))    # cos(è§’åº¦)
    E7 = math.tan(math.radians(B6))    # tan(è§’åº¦)
    E8 = math.tan(math.radians(B6)/2)  # tan(è§’åº¦/2)

    # ======== è¨ˆç®—éç¨‹ä¸­é–“å€¼ ========
    E9 = B5 + (B7 - B4) / E7            # æ–œè§’èˆ‡å°å¾‘å»¶ä¼¸äº¤é» Z

    # ======== å¹¾ä½•é‹ç®—çš„ä¸­é–“åº§æ¨™ï¼ˆHæ¬„ï¼‰========
    H4  = B5 + B8 * E8                  # Rå‰ç«¯ Zä½ç½®
    H5  = B4 - B8 * (1.0 - E6)          # Rå‰ç«¯ Xä½ç½®
    H6  = B5 - B8 * (E5 - E8)           # Rå‰ç«¯ Zä½ç½®å»¶ä¼¸
    H8  = E9 - B9 * E8                  # å¾Œç«¯ R åº§æ¨™ç”¨
    H9  = B7 + B9 * (1.0 - E6)          # å°å¾‘äº¤ç•Œ X
    H10 = E9 + B9 * (E5 - E8)           # å°å¾‘äº¤ç•Œ Z

    # ======== æœ€çµ‚è¼¸å‡ºï¼ˆå°æ‡‰ Excel B13~B20ï¼‰========
    B13 = B4 + E4                       # å·¦å´é» X
    B51 = (B13-E4)*2
    B14 = H4                            # å·¦å´é» Z
    B52 = B14-E4 
    B15 = H5 + E4 * E6                  # Ré» X ä¿®æ­£
    B53 = (B15-E4)*2
    B16 = H6 - E4 * E5                  # Ré» Z ä¿®æ­£
    B54 = B16-E4 
    B17 = H9 + E4 * E6                  # å³å´é» X
    B55 = (B17-E4)*2
    B18 = H10 - E4 * E5                 # å³å´é» Z
    B56 = B18-E4
    B19 = B7 + E4                       # å°å¾‘å³å´ X
    B57 = (B19-E4)*2
    B20 = H8                            # å°å¾‘å»¶ä¼¸ Z
    B58 = B20-E4

    def _fmt(x):
     # ä¾‹å¦‚å›ºå®šé¡¯ç¤ºåˆ°å°æ•¸é»å…©ä½
        return f"{x:.3f}"

 

    result_values = {
         "B51": B51,
         "B52": B52,
         "B53": B53,
         "B54": B54,
         "B55": B55,
         "B56": B56,
         "B57": B57,
         "B58": B58,
     }

    text_lines = [
        "â¡ï¸ å‰ç«¯æ–œè§’ â†’ å¹³ç·š â†’ çµ‚é»å¼§ï¼ˆC å·¥å» ï¼‰",
        f"B51 = {_fmt(B51)}",
        f"B52 = {_fmt(B52)}",
        f"B53 = {_fmt(B53)}",
        f"B54 = {_fmt(B54)}",
        f"B55 = {_fmt(B55)}",
        f"B56 = {_fmt(B56)}",
        f"B57 = {_fmt(B57)}",
        f"B58 = {_fmt(B58)}",
    ]

    return {
        "ok": True,
        "text_lines": text_lines,
        "values": result_values,
    }


# -------------------------------------------------------
# ğŸ” å°å¤–çµ±ä¸€ä»‹é¢
# -------------------------------------------------------
def solve(data: dict):
    return solve_b(data)